<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sora Metrics Dashboard</title>
  <link rel="stylesheet" href="dashboard.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">Sora Creator Tools – Dashboard Mode</div>
    <div class="actions">
      <button id="resetZoom" title="Reset zoom to fit">Reset Zoom</button>
      <button id="refresh">Refresh Data</button>
      <button id="export" title="Export all collected data to CSV">Export Data</button>
      <button id="import" title="Import data from previously exported CSV">Import Data</button>
      <input type="file" id="importFile" accept=".csv" style="display: none;" />
      <button id="purgeMenu" title="Purge data">Purge Data Menu</button>
    </div>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <h3>Posts</h3>
      <div class="list-actions">
        <button id="showAll" title="Show all posts">Show All</button>
        <button id="hideAll" title="Hide all posts">Hide All</button>
        <button id="last5" title="Show last 5 posts by time">Last 5</button>
        <button id="last10" title="Show last 10 posts by time">Last 10</button>
        <button id="top5" title="Show top 5 posts by likes">Top 5</button>
        <button id="top10" title="Show top 10 posts by likes">Top 10</button>
        <button id="bottom5" title="Show 5 least liked posts (excluding last 24 hours)">Bottom 5</button>
        <button id="bottom10" title="Show 10 least liked posts (excluding last 24 hours)">Bottom 10</button>
        <button id="stale" title="Show posts whose metrics haven't refreshed in 24h">Stale</button>
      </div>
      <div id="posts" class="posts"></div>
    </aside>
    <section class="content">
      <h3 class="section-title section-title-first">Individual Metrics</h3>
      <p style="color: var(--muted); font-size: 14px; margin-top: -8px; margin-bottom: 16px;">Keep Gather mode running in a new window on any profile for always up-to-date data</p>
      <div class="user-select-section">
        <div class="user-select-header">
          <div class="user-picker">
            <input id="search" type="search" placeholder="Type to find user…" autocomplete="off" />
            <div id="suggestions" class="suggestions"></div>
          </div>
          <select id="userSelect" title="All users" class="user-select-dropdown"></select>
        </div>
      </div>
      <div style="display: flex; flex-wrap: wrap; gap: 8px 8px; margin-bottom: 12px;">
        <div id="totalViewsSummary" class="metric-card" title="Sum of latest total views for visible posts">
          <span id="totalViewsTotal" class="value">0</span>
          <span class="label">Total Views</span>
        </div>
        <div id="uniqueViewsSummary" class="metric-card" title="Sum of latest unique views for visible posts">
          <span id="uniqueViewsTotal" class="value">0</span>
          <span class="label">Unique Views</span>
        </div>
        <div id="likesSummary" class="metric-card" title="Sum of latest likes for visible posts">
          <span id="likesTotal" class="value">0.00</span>
          <span class="label">Likes</span>
        </div>
        <div id="repliesSummary" class="metric-card" title="Sum of latest replies for visible posts (non-recursive)">
          <span id="repliesTotal" class="value">0.00</span>
          <span class="label">Replies</span>
        </div>
        <div id="remixesSummary" class="metric-card" title="Sum of latest recursive remixes for visible posts">
          <span id="remixesTotal" class="value">0.00</span>
          <span class="label">Recursive Remixes</span>
        </div>
        <div id="interactionsSummary" class="metric-card" title="Sum of latest interactions (likes + comments) for visible posts">
          <span id="interactionsTotal" class="value">0.00</span>
          <span class="label">Interactions</span>
        </div>
        <div id="userCameosSummary" class="metric-card" title="Profile cast in count">
          <span id="userCameosTotal" class="value">0</span>
          <span class="label">Cast in</span>
        </div>
        <div id="userFollowersSummary" class="metric-card" title="Latest follower count">
          <span id="userFollowersTotal" class="value">0</span>
          <span class="label">Followers</span>
        </div>
      </div>
      <div style="display: flex; gap: 8px; margin-bottom: 12px; align-items: center;">
        <button id="uniqueViewsPill" class="views-pill active" data-type="unique">Unique Views</button>
        <button id="totalViewsPill" class="views-pill" data-type="total">Total Views</button>
      </div>
      <h4 class="chart-title">Interaction Rate</h4>
      <div class="chart-wrap">
        <canvas id="chart" width="900" height="540"></canvas>
        <div id="tooltip" class="tooltip"></div>
      </div>
      <h4 class="chart-title">Views over Time</h4>
      <div class="chart-wrap" style="margin-top:10px">
        <canvas id="viewsChart" width="900" height="540"></canvas>
        <div id="viewsTooltip" class="tooltip"></div>
      </div>
      <h4 class="chart-title">Views in First 24 Hours</h4>
      <div class="chart-wrap" style="margin-top:10px">
        <canvas id="first24HoursChart" width="900" height="540"></canvas>
        <div id="first24HoursTooltip" class="tooltip"></div>
        <div style="margin-top: 10px; padding: 4px; background: var(--bg-subtle); border: 1px solid var(--border-subtle); border-radius: 4px;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <label style="color: var(--muted); font-size: 12px; min-width: 100px; flex-shrink: 0;">Time Window</label>
            <input type="range" id="first24HoursSlider" min="15" max="1440" value="1440" step="15" style="flex: 1; height: 6px; background: var(--grid); border-radius: 3px; outline: none;" />
            <span id="first24HoursSliderValue" style="color: var(--fg); font-size: 12px; min-width: 70px; text-align: right; flex-shrink: 0;">24 hrs</span>
          </div>
        </div>
      </div>
      <h4 class="chart-title">Views Per Person in First 24 Hours</h4>
      <div class="chart-wrap" style="margin-top:10px">
        <canvas id="viewsPerPersonChart" width="900" height="540"></canvas>
        <div id="viewsPerPersonTooltip" class="tooltip"></div>
        <div style="margin-top: 10px; padding: 4px; background: var(--bg-subtle); border: 1px solid var(--border-subtle); border-radius: 4px;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <label style="color: var(--muted); font-size: 12px; min-width: 100px; flex-shrink: 0;">Time Window</label>
            <input type="range" id="viewsPerPersonSlider" min="15" max="1440" value="1440" step="15" style="flex: 1; height: 6px; background: var(--grid); border-radius: 3px; outline: none;" />
            <span id="viewsPerPersonSliderValue" style="color: var(--fg); font-size: 12px; min-width: 70px; text-align: right; flex-shrink: 0;">24 hrs</span>
          </div>
        </div>
      </div>
      <h3 class="section-title">BEST TIME TO POST</h3>
      <p style="color: var(--muted); font-size: 14px; margin-top: -8px; margin-bottom: 16px;">Based on data from all the posts you've ever browsed on Sora.</p>
      <div id="bestTimeToPostSection" style="margin-bottom: 32px;">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 16px;">
          <div class="best-time-metric-card">
            <div class="best-time-metric-header">For Views...</div>
            <div id="bestTimeViewsGrid" class="best-time-grid"></div>
          </div>
          <div class="best-time-metric-card">
            <div class="best-time-metric-header">For Likes...</div>
            <div id="bestTimeLikesGrid" class="best-time-grid"></div>
          </div>
          <div class="best-time-metric-card">
            <div class="best-time-metric-header">For Remixes...</div>
            <div id="bestTimeRemixesGrid" class="best-time-grid"></div>
          </div>
        </div>
      </div>
      <h3 class="section-title">Compare Total Metrics</h3>
      <p style="color: var(--muted); font-size: 14px; margin-top: -8px; margin-bottom: 16px;">You must run Gather mode on any profile for up-to-date and complete data</p>
      <div class="compare-section">
        <div class="compare-header">
          <div class="compare-controls">
            <div class="compare-search-row">
              <div class="user-picker-compare">
                <input id="compareSearch" type="search" placeholder="Type to find user to compare…" autocomplete="off" />
                <div id="compareSuggestions" class="suggestions"></div>
              </div>
              <select id="compareUserSelect" title="Select user to add" class="compare-select-dropdown"></select>
            </div>
            <div id="comparePills" class="compare-pills"></div>
          </div>
        </div>
      </div>
      <div style="display: flex; flex-wrap: wrap; gap: 8px 8px; margin-bottom: 12px;">
        <div id="allTotalViewsSummary" class="metric-card" title="Sum of latest total views across all posts (ignores visibility)">
          <span id="allTotalViewsTotal" class="value">0</span>
          <span class="label">Total Views</span>
        </div>
        <div id="allUniqueViewsSummary" class="metric-card" title="Sum of latest unique views across all posts (ignores visibility)">
          <span id="allUniqueViewsTotal" class="value">0</span>
          <span class="label">Unique Views</span>
        </div>
        <div id="allLikesSummary" class="metric-card" title="Sum of latest likes across all posts (ignores visibility)">
          <span id="allLikesTotal" class="value">0.00</span>
          <span class="label">Likes</span>
        </div>
        <div id="allRepliesSummary" class="metric-card" title="Sum of latest replies across all posts (ignores visibility)">
          <span id="allRepliesTotal" class="value">0.00</span>
          <span class="label">Replies</span>
        </div>
        <div id="allRemixesSummary" class="metric-card" title="Sum of latest recursive remixes across all posts (ignores visibility)">
          <span id="allRemixesTotal" class="value">0.00</span>
          <span class="label">Recursive Remixes</span>
        </div>
        <div id="allInteractionsSummary" class="metric-card" title="Sum of latest interactions across all posts (ignores visibility)">
          <span id="allInteractionsTotal" class="value">0.00</span>
          <span class="label">Interactions</span>
        </div>
        <div id="allCameosSummary" class="metric-card" title="Profile cast in count (ignores visibility)">
          <span id="allCameosTotal" class="value">0</span>
          <span class="label">Cast in</span>
        </div>
        <div id="followersSummary" class="metric-card" title="Latest follower count for the selected user">
          <span id="followersTotal" class="value">0</span>
          <span class="label">Followers</span>
        </div>
      </div>
      <h4 class="chart-title">Followers over Time</h4>
      <div class="chart-wrap" style="margin-top:10px">
        <canvas id="followersChart" width="900" height="540"></canvas>
        <div id="followersTooltip" class="tooltip"></div>
      </div>
      <h4 class="chart-title">Total Views over Time</h4>
      <div class="chart-wrap" style="margin-top:10px">
        <canvas id="allViewsChart" width="900" height="540"></canvas>
        <div id="allViewsTooltip" class="tooltip"></div>
      </div>
      <h4 class="chart-title">Likes over Time</h4>
      <div class="chart-wrap" style="margin-top:10px">
        <canvas id="allLikesChart" width="900" height="540"></canvas>
        <div id="allLikesTooltip" class="tooltip"></div>
      </div>
      <h4 class="chart-title">Cast In over Time</h4>
      <div class="chart-wrap" style="margin-top:10px">
        <canvas id="cameosChart" width="900" height="540"></canvas>
        <div id="cameosTooltip" class="tooltip"></div>
      </div>
      
      <div class="help">Drag to zoom • Hover to focus series • Click point to open post • Double-click to reset zoom • Toggle visibility in sidebar • Run Gather mode on Profile or Top feeds to collect data!</div>
    </section>
  </main>

  <!-- Purge Menu Modal -->
  <div id="purgeModal" class="purge-modal-overlay" style="display: none;">
    <div class="purge-modal-panel">
      <div class="purge-modal-header">
        <h2>Purge Data</h2>
        <button id="purgeModalClose" class="purge-modal-close">×</button>
      </div>
      
      <div class="purge-modal-content">
        <!-- Date Range Slider -->
        <div class="purge-control-group">
          <div class="purge-control-label">
            <span>Keep posts within last</span>
            <span id="dateRangeValue" class="purge-value-display">1 year</span>
          </div>
          <div class="purge-slider-container">
            <div class="purge-slider-track">
              <div class="purge-slider-fill" id="dateRangeFill"></div>
              <input type="range" id="dateRangeSlider" min="1" max="365" value="365" step="1" />
            </div>
            <div class="purge-slider-labels">
              <span>1 day</span>
              <span>365 days</span>
            </div>
          </div>
        </div>

        <!-- Post Count Slider -->
        <div class="purge-control-group">
          <div class="purge-control-label">
            <span>Keep everyone with</span>
            <span id="postCountValue" class="purge-value-display">0 posts</span>
          </div>
          <div class="purge-slider-container">
            <div class="purge-slider-track">
              <div class="purge-slider-fill" id="postCountFill"></div>
              <input type="range" id="postCountSlider" min="0" max="100" value="0" step="1" />
            </div>
            <div class="purge-slider-labels">
              <span>0 posts</span>
              <span>100+ posts</span>
            </div>
          </div>
        </div>

        <!-- Follower Count Slider -->
        <div class="purge-control-group">
          <div class="purge-control-label">
            <span>Keep everyone with</span>
            <span id="followerCountValue" class="purge-value-display">0 followers</span>
          </div>
          <div class="purge-slider-container">
            <div class="purge-slider-track">
              <div class="purge-slider-fill" id="followerCountFill"></div>
              <input type="range" id="followerCountSlider" min="0" max="10000" value="0" step="100" />
            </div>
            <div class="purge-slider-labels">
              <span>0 followers</span>
              <span>10K+ followers</span>
            </div>
          </div>
        </div>

        <!-- Exceptions Section -->
        <div class="purge-exceptions-section">
          <div class="purge-exceptions-label">Exceptions</div>
          <div class="purge-exceptions-controls">
            <div class="purge-exceptions-search-row">
              <div class="user-picker-exceptions">
                <input id="exceptionsSearch" type="search" placeholder="Add user to except…" autocomplete="off" />
                <div id="exceptionsSuggestions" class="suggestions"></div>
              </div>
              <select id="exceptionsUserSelect" title="Select user to except" class="exceptions-select-dropdown"></select>
            </div>
            <div id="exceptionsPills" class="exceptions-pills"></div>
          </div>
        </div>

        <!-- Review Section -->
        <div class="purge-review-section">
          <div class="purge-review-label">Preview:</div>
          <div id="purgeReviewText" class="purge-review-text">
            You are about to purge all data outside the last 1 year.
          </div>
        </div>

        <!-- Actions -->
        <div class="purge-actions">
          <button id="purgeExecute" class="purge-execute-btn">Purge</button>
        </div>

        <!-- Storage Size Display -->
        <div class="purge-storage-size">
          <span id="purgeStorageSize">Sora Creator Tools currently uses 0.00MB of memory.</span>
          <label class="purge-comb-mode-label">
            <input type="checkbox" id="combModeCheckbox" checked />
            <span class="purge-comb-mode-helper">Auto-purge old data captured more frequently than every hour.</span>
          </label>
        </div>
      </div>
    </div>

    <!-- Confirmation Dialog -->
    <div id="purgeConfirmDialog" class="purge-confirm-dialog" style="display: none;">
      <div class="purge-confirm-content">
        <h3>⚠️ This cannot be undone!</h3>
        <p id="purgeConfirmText">Are you sure you want to proceed with purging data based on your selected criteria?</p>
        <div class="purge-confirm-actions">
          <button id="purgeConfirmYes" class="purge-confirm-yes">Yes, Purge</button>
          <button id="purgeConfirmNo" class="purge-confirm-no">Cancel</button>
        </div>
      </div>
    </div>

  </div>

  <!-- Post Purge Confirmation Dialog -->
  <div id="postPurgeConfirm" class="purge-confirm-dialog" style="display: none;">
    <div class="purge-confirm-content">
      <h3>⚠️ This cannot be undone!</h3>
      <p id="postPurgeConfirmText">Are you sure you want to purge data tied to ""?</p>
      <div class="purge-confirm-actions">
        <button id="postPurgeConfirmYes" class="purge-confirm-yes">Yes, Purge</button>
        <button id="postPurgeConfirmNo" class="purge-confirm-no">Cancel</button>
      </div>
    </div>
  </div>

  <script src="dashboard.js"></script>
</body>
</html>
